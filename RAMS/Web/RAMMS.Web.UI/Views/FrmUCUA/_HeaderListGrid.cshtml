
<style>
    .headcol {
        position: sticky;
        left: 0;
    }
</style>
<div class="main-container" id="container">
    <div id="content">
        <table id="FormUCUAGridView" class="table w-100 nowrap">
        </table>
    </div>
</div>
@inject RAMMS.Business.ServiceProvider.Interfaces.ISecurity security;
<script src="~/js/CDTGrid.js"></script>
<script>

    debugger;
  var isModifyPerm = @security.IsPCModify(ModuleNameList.Condition_Inspection).ToString().ToLowerInvariant()? "" : "hidden";
    var isDeletePerm =@security.IsPCDelete(ModuleNameList.Condition_Inspection).ToString().ToLowerInvariant()? "" : "hidden";
    var isViewPerm = @security.IsPCView(ModuleNameList.Condition_Inspection).ToString().ToLowerInvariant() ? "" : 'hidden';
    var table_columns = [];
    var actionCol = {
        data: null, name: "Action", title: "Action", class: "headcol", autoWidth: true, sortable: false, render: function (data) {
            debugger;
            if (data.pkRefNo != "" && data.pkRefNo != null) {
                title = data.pkRefNo;
            }
            if (data.submitSts && (data.status == "Approved" || data.status == "Verified" )) {
                var actionSection = "<div class='btn-group dropright' id='actiondropdown'> <button id='actionclick' type='button' class='btn btn-sm btn-themebtn dropdown-toggle' data-toggle='dropdown'> Click Me </button><div class='dropdown-menu'><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' data-toggle='modal'   data-target='#myModal' onclick='javascript:viewDetail(" + data.pkRefNo + ");'><span class='view-icon'></span> View</button><button type='button' class='dropdown-item editdel-btns'" + isDeletePerm + " onclick='javascript:deleteUCUAHeader(" + data.pkRefNo + ");'><span class='del-icon'></span> Delete</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' onclick='javascript:PrintForm(" + data.pkRefNo + ");' href=''><span class='print-icon'></span> Print</button></div></div>";
                
                return actionSection;
            }
            else {
                var actionSection = "<div class='btn-group dropright' id='actiondropdown'> <button id='actionclick' type='button' class='btn btn-sm btn-themebtn dropdown-toggle' data-toggle='dropdown'> Click Me </button><div class='dropdown-menu'><button type='button' class='dropdown-item editdel-btns' id=data-backdrop='static' id='formAHeaderEdit'" + isModifyPerm + " onclick='javascript:editDetail(" + data.pkRefNo + ");'><span class='edit-icon'></span> Edit</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' data-toggle='modal'   data-target='#myModal' onclick='javascript:viewDetail(" + data.pkRefNo + ");'><span class='view-icon'></span> View</button><button type='button' class='dropdown-item editdel-btns'" + isDeletePerm + " onclick='javascript:deleteUCUAHeader(" + data.pkRefNo + ");'><span class='del-icon'></span> Delete</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' onclick='javascript:PrintForm(" + data.pkRefNo + ");' href=''><span class='print-icon'></span> Print</button></div></div>";
                return actionSection;
            }
        }
        // data: null, name: "Action", title: "Action", autoWidth: false, width: 25, sortable: false, render: function (data, type, full) {
        //    var actionSection = "<div class='btn-group dropright' id='actiondropdown'> <button id='actionclick' type='button' class='btn btn-sm btn-themebtn dropdown-toggle' data-toggle='dropdown'> Click Me </button><div class='dropdown-menu'><button type='button' class='dropdown-item editdel-btns' id=data-backdrop='static' id='formAHeaderEdit'" + isModifyPerm + " onclick='javascript:editDetail(" + data.pkRefNo + ");'><span class='edit-icon'></span> Edit</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' data-toggle='modal'   data-target='#myModal' onclick='javascript:viewDetail(" + data.pkRefNo + ");'><span class='view-icon'></span> View</button><button type='button' class='dropdown-item editdel-btns'" + isDeletePerm + " onclick='javascript:deleteUCUAHeader(" + data.pkRefNo + ");'><span class='del-icon'></span> Delete</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' onclick='javascript:PrintForm(" + data.pkRefNo + ");' href=''><span class='print-icon'></span> Print</button></div></div>";
        //    // var actionSection = "<div class='btn-group dropright' id='actiondropdown'> <button id='actionclick' type='button' class='btn btn-sm btn-themebtn dropdown-toggle' data-toggle='dropdown'> Click Me </button><div class='dropdown-menu'><button type='button' class='dropdown-item editdel-btns'  id='formAHeaderEdit'" + isModifyPerm + " data-toggle='modal'   data-target='#myModal' onclick='javascript:editDetail(" + data.pkRefNo + ");'><span class='edit-icon'></span> Edit</button><button type='button' class='dropdown-item editdel-btns'" + isDeletePerm + " onclick='javascript:DeleteFormTDtl(" + data.pkRefNo + ");'><span class='del-icon'></span> Delete</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' data-toggle='modal'   data-target='#myModal' onclick='javascript:EditFormTDtl(this,1);'><span class='view-icon'></span> View</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' onclick='javascript:PrintForm(" + data.pkRefNo + ");' href=''><span class='print-icon'></span> Print</button></div></div>";
        //    var viewaction = "<div class='btn-group dropright' id='actiondropdown'> <button id='actionclick' type='button' class='btn btn-sm btn-themebtn dropdown-toggle' data-toggle='dropdown'> Click Me </button><div class='dropdown-menu'><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' data-toggle='modal'   data-target='#myModal' onclick='javascript:viewDetail(" + data.pkRefNo + ");'><span class='view-icon'></span> View</button><button type='button' class='dropdown-item editdel-btns'" + isDeletePerm + " onclick='javascript:deleteUCUAHeader(" + data.pkRefNo + ");'><span class='del-icon'></span> Delete</button><button type='button' class='dropdown-item editdel-btns' id='btnAssetView' onclick='javascript:PrintForm(" + data.pkRefNo + ");' href=''><span class='print-icon'></span> Print</button></div></div>";
        //    debugger;
        //     if ($("#hdnView").val() == "1") {
        //        return viewaction;
        //    }
        //    else if ($("#SubmitYn").val() == "True" || ($("#Status").val() == "Approved")) {
        //        return viewaction;
        //    }
        //    else {
        //        return actionSection;
        //    }
        //}
    };
    var noCol = { data: "pkRefNo", name: "No", title: "NO", autoWidth: true, sortable: false, visible: false };
    var refNoCol = { data: "refId", name: "Id", title: "UCUA Reference No", autoWidth: true, sortable: true };
    var Location = { data: "location", name: "Location", title: "Location", autoWidth: true, sortable: true };
    var WorkScope = { data: "workScope", name: "WorkScope", title: "Work Scope", autoWidth: true, sortable: true };

    var dateReceived = {
        data: null, name: "date", title: "Date Received", autoWidth: true, sortable: true,
        render: function (data) {
            if (data.date) {
                var d = new Date(data.date);
                var day = d.getDate();
                var month = d.getMonth() + 1;
                var year = d.getFullYear();
                if (day < 10) {
                    day = "0" + day;
                }
                if (month < 10) {
                    month = "0" + month;
                }
                var date = day + "/" + month + "/" + year;
                return date;
            }
            else
                return "";
        }
    };


    var statuscol = { data: "status", name: "Status", title: "Status", autoWidth: true, sortable: true };


    table_columns.push(noCol);
    table_columns.push(actionCol);
    table_columns.push(refNoCol);
    table_columns.push(Location);
    table_columns.push(WorkScope);
    table_columns.push(dateReceived);
    table_columns.push(statuscol);


    function PrintForm(id) {
        window.location.href = '/FrmUCUA/FormTDownload?id=' + id;
    }

    function editDetail(id) {
        window.location.href = '/FrmUCUA/Add?id=' + id + '&isview=0';
    }

    function viewDetail(id) {
        window.location.href = '/FrmUCUA/Add?id=' + id + '&isview=1';
    }

    function deleteUCUAHeader(id) {
        app.Confirm("Are you sure you want to delete the record?, If Yes click OK.", function (e) {
            if (e) {
                var req = {};
                req.id = id;
                $.ajax({
                    url: '/FrmUCUA/DeleteFormUCUA',
                    dataType: 'JSON',
                    data: req,
                    type: 'Post',
                    success: function (data) {
                        if (data) {
                            app.ShowSuccessMessage("Record deleted successfully");
                            oTable.draw();
                        }
                        else {
                            app.ShowErrorMessage("Please try again.")
                        }

                    },
                    error: function (data) {

                        console.error(data);
                    }
                });
            }
        });
    }

    var filterData = new Object();

    function InitializeGrid() {


        var _currentGridSettings = new CustomGridSettings();
        $.extend($.fn.dataTable.defaults, _currentGridSettings);

        filterData.SmartSearch = $("#txtSmartSearch").val();
        filterData.ReportingName = $("#txtReportingName").val();
        filterData.Location = $("#txtLocation").val();
        filterData.WorkScope = $("#txtWorkScope").val();
        filterData.ReceivedDtFrom = $("#txtReceivedDtFrom").val();
        filterData.ReceivedDtTo = $("#txtReceivedDtTo").val();

        debugger;
        $('#FormUCUAGridView').DataTable({

            ajax: {
                url: "/FrmUCUA/GetHeaderList",
                type: "POST",
                datatype: "json",
                data: {
                    filterData
                }
            },
            columns: table_columns
        });
    }


    $(document).ready(function () {
        InitializeGrid();

        //Apply Custom search on jQuery DataTables here
        oTable = $('#FormUCUAGridView').DataTable();

        $("#btnClearSearch").click(function () {
            //debugger;
            $("#txtReportingName").val('');
            $("#txtLocation").val('');
            $("#txtWorkScope").val('');
            $("#txtReceivedDtFrom").val('');
            $("#txtReceivedDtTo").val('');

            $("#btnSearch").click();

        });
        $('#btnSearch').click(function () {
            //debugger;
            //filterData.ReportingName = $("#txtReportingName").val();
            //filterData.Location = $("#txtLocation").val();
            //filterData.WorkScope = $("#txtWorkScope").val();
            //filterData.ReceivedDtFrom = $("#txtReceivedDtFrom").val();
            //filterData.ReceivedDtTo = $("#txtReceivedDtTo").val();

            oTable.columns(0).search($("#txtSmartSearch").val());
            oTable.columns(1).search($("#txtReportingName").val());
            oTable.columns(2).search($("#txtLocation").val());
            oTable.columns(3).search($("#txtWorkScope").val());
            oTable.columns(4).search($("#txtReceivedDtFrom").val());
            oTable.columns(5).search($("#txtReceivedDtTo").val());
            oTable.data = filterData;
            oTable.draw();
        });
    });
</script>