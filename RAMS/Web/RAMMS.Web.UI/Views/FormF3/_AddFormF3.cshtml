@using RAMMS.DTO.RequestBO;
@using RAMMS.Business.ServiceProvider;
@inject RAMMS.Business.ServiceProvider.Interfaces.IUserService usr
@inject RAMMS.Business.ServiceProvider.Interfaces.IFormF3Service formS2
@inject RAMMS.Business.ServiceProvider.Interfaces.IDDLookUpService ddlService
@model RAMMS.Web.UI.Models.FormF3Model;
@inject RAMMS.Business.ServiceProvider.Interfaces.ISecurity security;
@{
    //ViewBag.TabTitle = "ASSET MAINTANENCE - Form N1 - Road Asset Management and Maintenance System";
    //ViewData["Title"] = "ASSET MAINTANENCE - Form N1 - Road Asset Management and Maintenance System";
    Layout = "~/Views/Shared/_PortalLayout.cshtml";
    IEnumerable<SelectListItem> division = (await ddlService
       .GetLookups(new DDLookUpDTO { Type = "Division" }))
       .Select(s => new SelectListItem
       {
           Text = s.DdlTypeDesc,
           Value = s.DdlTypeValue
       }).ToArray();

    IEnumerable<SelectListItem> year = (await ddlService
        .GetLookups(new DDLookUpDTO { Type = "Year" }))
        .Select(s => new SelectListItem
        {
            Text = s.DdlTypeValue,
            Value = s.DdlTypeValue
        }).ToArray();
    IEnumerable<SelectListItem> section = (await ddlService
       .GetLookups(new DDLookUpDTO { Type = "Section Code" }))
       .Select(s => new SelectListItem
       {
           Text = s.DdlTypeCode + "-" + s.DdlTypeDesc,
           Value = s.DdlTypeCode
       }).ToArray();

    IEnumerable<SelectListItem> roadcode = new[] {new SelectListItem
       {
           Text = "Select Road Code",
           Value = ""
       } };

    IEnumerable<SelectListItem> rmu = (await ddlService
       .GetLookups(new DDLookUpDTO { Type = "RMU" }))
       .Select(s => new SelectListItem
       {
           Text = s.DdlTypeCode + "-" + s.DdlTypeDesc,
           Value = s.DdlTypeCode
       }).ToArray();

    IEnumerable<SelectListItem>
    user = (await usr.GetUserNameRespectToPosition(new UserRequestDTO
    {
        Position = "Supervisor"
    })).ToList().Select(s => new SelectListItem { Value = s.UserId.ToString(), Text = (s.UserId.ToString() + "-" + s.UserName) }).ToArray();

    bool isSubmit = (security.isOperRAMSExecutive || security.IsExecutive || security.isEnggAssistant || security.IsSupervisor);
    bool IsApproved = (security.isOperRAMSExecutive || security.IsExecutive || security.IsHeadMaintenance || security.IsRegionManager);
    var groupname = security.Group.IndexOf(",") >= 0 ? security.Group.Split(',')[0] : security.Group;


}


<script type="text/javascript" src="~/js/MAMFormF3.js" asp-append-version="true"></script>

@using (Html.BeginForm())
{

    <div class="row">
        <div class="w-100 bg-body" id="">
            <div id="headerDiv">
                <div class="modal-body mh-120 pt-0 pb-0">
                    <div class="d-flex justify-content-center pt-3 pb-3">
                        <div id="" class="form-group mb-0">
                            @Html.Label("Form F3 No.", "Form F3 No.", new { style = "float:left; padding: .5rem .5rem 0 !important;" })
                            @Html.TextBoxFor(model => model.FormF3.PkRefId, new { @readonly = "true", @class = "form-control", @style = "width:300px;" })
                        </div>
                    </div>
                    <div class="clear-b"></div>
                    <div class="bg-white rounded pt-3 pb-1 px-lg-3 px-md-2 landing-division w-100 mb-3">
                        <div class="row">
                            <div class="col-lg-10 p-0">
                                <div id="headerFindDiv" class="w-100 form-group mb-0">
                                    @*<div class="form-group col-md-3">
                                        @Html.Label("Asset Group", "Asset Group")
                                        <input class="form-control" value="Guardrail" disabled />
                                        </div>*@
                                    <div class="form-group col-md-3">
                                        @Html.Label("Division", "Division")
                                        @Html.DropDownListFor(m => m.FormF3.DivCode, division, "Select Division", new { @Id = "ddlDivision", @class = "form-control" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("District", "District")
                                        @*<input id="txtDist" class="form-control" value="@Model.FormF3.Dist" />*@
                                        @Html.TextBoxFor(model => model.FormF3.Dist, new { @class = "form-control" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("RMU", "RMU")

                                        @Html.DropDownListFor(Ahdr => Ahdr.FormF3.RmuCode, rmu, "Select RMU", new { @Id = "ddlRMU", @class = "form-control validate {required, RMU}" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Section Code", "Section Code")

                                        @Html.DropDownListFor(Ahdr => Ahdr.FormF3.SecCode, section, "Select Section Code", new { @Id = "ddlSection", @class = "form-control validate {required, Section Code}" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Section Name", "Section Name")
                                        @Html.TextBoxFor(model => model.FormF3.SecName, new { @readonly = true, @class = "form-control" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Road Code", "Road Code")
                                        @Html.DropDownListFor(Ahdr => Ahdr.FormF3.RdCode, roadcode, "Select RoadCode", new { @Id = "ddlRoadCode", @class = "form-control validate {required, Road Code}" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Road Name", "Road Name")
                                        @*<input id="txtRoadName" disabled="disabled" type="text" class="form-control" />*@
                                        @Html.TextBoxFor(model => model.FormF3.RdName, new { @readonly = true, @class = "form-control" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Road Length (km)", "Road Length (km)")
                                        @*<input id="txtRoadlength" disabled="disabled" type="text" value="@Model.FormF3.RoadLength" class="form-control" />*@
                                        @Html.TextBoxFor(model => model.FormF3.RoadLength, new { @readonly = true, @class = "form-control" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Year of Inspection (YYYY)", "Year of Inspection (YYYY)")
                                        @Html.DropDownListFor(Ahdr => Ahdr.FormF3.InspectedYear, year, "Select Year", new { @Id = "ddlYear", @class = "form-control validate {required, Year }" })
                                    </div>
                                    <div class="form-group col-md-3">
                                        @Html.Label("Source", "Source")
                                        @Html.DropDownListFor(Adtl => Adtl.FormF3.Source, (new List<SelectListItem> { new SelectListItem { Text = "New Signages", Value = "New" }, new SelectListItem { Text = "Form G1/G2", Value = "G1G2" } }), "Select Source", new { @Id = "ddlSource", @class = "form-control validate {required, Source }" })
                                    </div>


                                </div>
                            </div>
                            <div class="form-group col-lg-2 col-md-12 pt-xl-4 px-md-4 px-sm-4">
                                <button id="btnFindDetails" type="button" onclick="Save('','')" class="btn btn-sm btn-themebtn col-md-12 col-xl-12 col-lg-2 mr-lg-1 float-right">Find Details</button>
                            </div>
                        </div>
                    </div>
                    <div class="clear-b"></div>
                    <div class="w-100 position-relative in-tbl-btns">
                        <div id="DetailListGrid" class="w-100 dt-tbl-section">
                            @{
                                Html.RenderPartial("_DetailGridList.cshtml");
                            }
                        </div>
                    </div>

                    <div id="F3UserDetail" class="col-lg-12 px-lg-5">
                        <div class="bg-white rounded landing-division w-100 float-left mb-3">
                            <div class="col-lg-12 py-2 px-4">
                                <span class="font-14 font-weight-bold">Crew Leader</span>
                            </div>
                            <div class="border-top px-2 pt-3 pb-1 float-left w-100">
                                <div class="form-group col-lg-2 float-left">
                                    @Html.Label("User ID", "User ID")
                                    @Html.DropDownListFor(Ahdr => Ahdr.FormF3.CrewSup, (IEnumerable<SelectListItem>)ViewData["Supervisor"], "User Id", new { @Id = "ddlCrew", @class = "form-control svalidate {required, Crew Leader}" })

                                </div>
                                <div class="form-group col-lg-3 float-left">
                                    @Html.Label("Name", "Name")
                                    @*<input id="txtCrewLeaderName" type="text" value="@Model.FormF3.CrewLeaderName" class="form-control svalidate {req,Crew leader Name}" disabled />*@
                                    @Html.TextBoxFor(model => model.FormF3.CrewName, new { @readonly = true, @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded landing-division w-100 float-left mb-0">
                            <div class="col-lg-12 py-2 px-4">
                                <span class="font-14 font-weight-bold">Inspected by</span>
                            </div>
                            <div class="border-top px-2 pt-3 pb-1 float-left w-100">
                                <div class="form-group col-lg-2 float-left">
                                    @Html.Label("User ID", "User ID")
                                    @Html.DropDownListFor(Ahdr => Ahdr.FormF3.InspectedBy, (IEnumerable<SelectListItem>)ViewData["User"], "User Id", new { @Id = "ddlInspectedby", @class = "form-control svalidate {required, Inspected by Id}" })

                                </div>
                                <div class="form-group col-lg-3 float-left">
                                    @Html.Label("Name", "Name")
                                    @*<input id="txtInspectedbyName" type="text" value="@Model.FormF3.UserNameInspBy" class="form-control svalidate {req,Inspected by User Name}" disabled />*@
                                    @Html.TextBoxFor(model => model.FormF3.InspectedName, new { @readonly = true, @class = "form-control" })
                                </div>
                                <div class="form-group col-lg-3 float-left">
                                    @Html.Label("Designation", "Designation")
                                    @Html.TextBoxFor(model => model.FormF3.InspectedDesig, new { @class = "form-control" })
                                </div>
                                <div class="form-group col-lg-3 float-left">
                                    @Html.Label("Date of Inspection (DD-MM-YYYY)", "Date of Inspection (DD-MM-YYYY)")
                                    @Html.EditorFor(m => m.FormF3.InspectedDate, new { type = "date", htmlAttributes = new { @class = "form-control" } })
                                </div>
                            </div>
                        </div>






                        @{
                            Html.RenderPartial("~/Views/Shared/_ProcessHistory.cshtml", new RAMMS.DTO.RequestBO.ProcessDTO
                            {
                                Form = "FormF3",
                                RefId = Model.FormF3.PkRefNo,
                                Stage = Model.FormF3.Status
                            });
                        }
                    </div>



                </div>
                <div class="modal-footer float-left w-100">
                    <button type="button" class="btn btn-sm btn-outline-theme" onclick="GoBack()">Cancel</button>
                    @{

                        if (isSubmit && (Model.FormF3.Status == null || Model.FormF3.Status == "" || Model.FormF3.Status == "Initialize" || Model.FormF3.Status == "Saved"))
                        {
                            <button id="saveFormF3Btn" type="button" class="btn btn-sm btn-themebtn" onclick="Save('','Saved')">Save</button>
                            <button id="SubmitFormF3Btn" type="button" class="btn btn-sm btn-themebtn" onclick="Save('','Submitted')">Submit</button>
                        }

                        if (IsApproved && (Model.FormF3.Status == RAMMS.Common.StatusList.Submitted || Model.FormF3.Status == RAMMS.Common.StatusList.Rejected))
                        {
                            <button type="button" class="btn btn-sm btn-themebtn enblmode" onclick="process.ShowApprove('@groupname','Verified By');"> Approved / Verify </button>
                        }

                    }
                </div>
            </div>
            <div id="myModal" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered modal-custom">

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">

                            <h4 class="modal-title">
                                Add Form F3 Details
                            </h4><button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body p-0">
                            <div class="mh-182 bg-white py-4">
                                <div id="AddDetailFormF2">
                                    <div class="col-lg-12 float-left">
                                        <div class="form-group col-lg-2">
                                            <label for="Starting_CHKm">Asset ID</label>

                                            @Html.DropDownList((IEnumerable<CSelectListItem>)ViewData["Asset"], "Scheduledby", "Select Asset ID", new { Id = "ddlAsset", @class = "form-control  {required,Asset}", @onchange = "OnAssetChange(this);" })
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label for="Location_Chainage_From">Location Chainage</label>
                                            <div class="row">
                                                <div class="col-6 float-left pr-0">
                                                    @Html.TextBoxFor(m => m.FormF3Dtl.LocCh, new { @readonly = "readonly", @class = "form-control" })
                                                </div>
                                                <div class="col-1 float-left p-0 text-center font-weight-bold lh30">+</div>
                                                <div class="col-5 float-left pl-0">
                                                    @Html.TextBoxFor(m => m.FormF3Dtl.LocChDeci, new { @readonly = "readonly", @class = "form-control" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group col-lg-2">
                                            <label for="Structure_Code">Structure Code</label>
                                            @Html.TextBoxFor(m => m.FormF3Dtl.Code, new { @readonly = "readonly", @class = "form-control" })
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label for="Bound">Bound</label>
                                            @Html.TextBoxFor(m => m.FormF3Dtl.Bound, new { @readonly = "readonly", @class = "form-control" })
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label for="Post_Spacing">
                                                Signboard Width

                                            </label>
                                            @Html.TextBoxFor(m => m.FormF3Dtl.Width, new { @readonly = "readonly", @class = "form-control" })
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label for="Length__M_"> Signboard Height</label>
                                            @Html.TextBoxFor(m => m.FormF3Dtl.Height, new { @readonly = "readonly", @class = "form-control" })
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label for="Bound">Overall Condition Rating</label>
                                            @Html.DropDownListFor(Adtl => Adtl.FormF3Dtl.ConditionI, (new List<SelectListItem> { new SelectListItem { Text = "1", Value = "1" }, new SelectListItem { Text = "2", Value = "2" }, new SelectListItem { Text = "3", Value = "3" } }), "Select Condition Rating", new { @Id = "ddlCondition", @class = "form-control {required, Contion Rating}" })
                                        </div>
                                        <div class="col-lg-10 form-group">
                                            <label for="Remarks">
                                                Description on the Sign Board
                                            </label>
                                            @Html.TextAreaFor(m => m.FormF3Dtl.Description, new { @class = "form-control  svalidate {required,Description}" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-2 float-left mt-2">
                                    <div class="abbrevations-group p-2">
                                        <div class="w-100 text-left float-left mb-3 font-weight-bold" style="text-decoration:underline;">Abbrevations</div>
                                        <div class="w-100 d-flex flex-column flex-md-row">
                                            <div class="d-flex flex-column col-md-3 p-0 mb-2">
                                                <span>
                                                    <span class="font-weight-bold font-14 mr-1">
                                                        <span class="float-left" style="width:20px;">
                                                            D
                                                        </span>:
                                                    </span><span class="text-nowrap">
                                                        Delineator
                                                    </span>
                                                </span>
                                                <span>
                                                    <span class="font-weight-bold font-14 mr-1">
                                                        <span class="float-left" style="width:20px;">
                                                            W
                                                        </span>:
                                                    </span><span class="text-nowrap">
                                                        Warning
                                                    </span>
                                                </span>
                                                <span>
                                                    <span class="font-weight-bold font-14 mr-1">
                                                        <span class="float-left" style="width:20px;">
                                                            Y
                                                        </span>:
                                                    </span><span class="text-nowrap">
                                                        Gantry Sign
                                                    </span>
                                                </span>
                                                <span>
                                                    <span class="font-weight-bold font-14 mr-1">
                                                        <span class="float-left" style="width:20px;">
                                                            G
                                                        </span>:
                                                    </span><span class="text-nowrap">Guide Sign</span>
                                                </span>
                                            </div>
                                            <div class="d-flex flex-column mb-2">
                                                <span class="d-flex flex-row align-items-start">
                                                    <span class="font-weight-bold font-14 mr-3 float-left text-nowrap">Condition 1</span><span class="float-left" style="padding-top:2px">
                                                        Traffic Signs is nearly new Condition, sign face can be seen clearly both during daylight and darkness hours.
                                                    </span>
                                                </span>
                                                <span class="d-flex flex-row align-items-start">
                                                    <span class="font-weight-bold font-14 mr-3 float-left text-nowrap">Condition 2</span>
                                                    <span class="float-left" style="padding-top:2px">
                                                        Sign face is fading but still can be seen both during daylight and darkness hours.
                                                    </span>
                                                </span>
                                                <span class="d-flex flex-row align-items-start">
                                                    <span class="font-weight-bold font-14 mr-3 float-left text-nowrap">Condition 3</span>
                                                    <span class="float-left" style="padding-top:2px">
                                                        Sign face reflective material badly deteriorated and obscured, reinstate or replacement is required.
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="btnDCancel" type="button" class="btn btn-sm btn-outline-theme Cancel"  data-dismiss="modal">Cancel</button>
                            <button id="btnSaveFormF3Dtl" type="button" onclick="SaveFormF3Dtl();" class="btn btn-sm btn-themebtn">Save &amp; Exit</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    @*Add F3 Details Modal*@

    @Html.HiddenFor(m => m.FormF3.PkRefNo)
    @Html.HiddenFor(m => m.FormF3Dtl.PkRefNo)
    @Html.HiddenFor(m => m.FormF3.DivCode)
    @Html.HiddenFor(m => m.FormF3.RmuCode)
    @Html.HiddenFor(m => m.FormF3.RdCode)
    @Html.HiddenFor(m => m.FormF3.SecCode)
    @Html.HiddenFor(m => m.FormF3.InspectedBy)
    @Html.HiddenFor(m => m.FormF3.Status)
    @Html.HiddenFor(m => m.FormF3.SubmitSts)
    @Html.HiddenFor(m => m.FormF3Dtl.AssetID)

    <input type="hidden" id="hdnSecCode" value="@Model.FormF3.SecCode" />
    <input type="hidden" id="hdnRdCode" value="@Model.FormF3.RdCode" />
    <input type="hidden" id="hdnView" value="@Model.view" />


}

<script>

    $(document).ready(function () {
        process.Init("FormF3", "@Model.FormF3.Status", @Model.FormF3.PkRefNo);
       
    });
    bindRoadCode();

    $('#ddlDivision').val("@Model.FormF3.DivCode");
    $('#ddlDivision').trigger('chosen:updated');
    $('#ddlDivision').trigger("change");

    $('#ddlRMU').val("@Model.FormF3.RmuCode");
    $('#ddlRMU').trigger('chosen:updated');
    $('#ddlRMU').trigger("change");

    $('#ddlSection').val("@Model.FormF3.SecCode");
    $('#ddlSection').trigger('chosen:updated');
    $('#ddlSection').trigger("change");

    $('#ddlRoadCode').val("@Model.FormF3.RdCode");
    $('#ddlRoadCode').trigger('chosen:updated');
    $('#ddlRoadCode').trigger("change");

    $('#ddlYear').val("@Model.FormF3.InspectedYear");
    $('#ddlYear').trigger('chosen:updated');
    $('#ddlYear').trigger("change");

    $('#ddlSource').val("@Model.FormF3.Source");
    $('#ddlSource').trigger('chosen:updated');
    $('#ddlSource').trigger("change");

    $('#ddlCrew').val("@Model.FormF3.CrewSup");
    $('#ddlCrew').trigger('chosen:updated');
    $('#ddlCrew').trigger("change");

    $('#ddlInspectedby').val("@Model.FormF3.InspectedBy");
    $('#ddlInspectedby').trigger('chosen:updated');
    $('#ddlInspectedby').trigger("change");
</script>
