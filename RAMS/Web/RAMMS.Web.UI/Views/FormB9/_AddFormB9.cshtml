@model RAMMS.Web.UI.Models.FormB9Model;
@using RAMMS.Business.ServiceProvider;
@using RAMMS.DTO.RequestBO;
@inject RAMMS.Business.ServiceProvider.Interfaces.IDDLookUpService ddlService
@inject RAMMS.Business.ServiceProvider.Interfaces.ISecurity security;
@{
    ViewBag.TabTitle = "Form B9";
    ViewData["Title"] = "Form B9";
    Layout = "~/Views/Shared/_PortalLayout.cshtml";

    IEnumerable<SelectListItem> year = (await ddlService
.GetLookups(new DDLookUpDTO { Type = "Year" })).Where(s => Convert.ToInt32(s.DdlTypeValue) >= Model.FormB9.RevisionYear)
.Select(s => new SelectListItem
{
    Text = s.DdlTypeValue,
    Value = s.DdlTypeValue
}).ToArray();

    IEnumerable<SelectListItem> UnitServiceLevel = (await ddlService
.GetLookups(new DDLookUpDTO { Type = "UnitServiceLevel" }))
.Select(s => new SelectListItem
{
    Text = s.DdlTypeDesc,
    Value = s.DdlTypeValue
}).ToArray();


}

<script type="text/javascript" src="~/js/FormB9.js" asp-append-version="true"></script>

<div class="row bg-white pt-3">
    <div class="w-100">
        <div class="body-header w-100">
            <div class="col-lg-12">
                <div class=" w-100 d-flex justify-content-center py-1">
                    <p class="font-24 mb-0"> <span class="float-left w-100 text-center"> <b>APPENDIX B9:</b> DESIRED SERVICE LEVEL (FOR RMU BATU NIAH AND RMU MIRI)</span> </p>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal-body mh-182 pt-4 pb-0">
    <div class="bg-white rounded pt-3 pb-1 px-lg-3 px-md-2 landing-division w-100 mb-3" id="divFindDetailsFC1C2">

        <div class="row">

            <div class="col-lg-12">
                <div class="w-100 bg-white py-0">
                    <div id="accordion">
                        <div class="tab-content">
                            <div class="tab-pane show active" id="FormB1TabPage1">
                                <div class="row">
                                    <div class="form-group col-3">
                                        <label>Select Year  </label>
                                        @Html.DropDownListFor(m => m.FormB9.RevisionYear, year, "Select Year", new { @Id = "ddlYear", @class = "form-control" })
                                    </div>
                                    <div class="form-group col-3">
                                        <label> Select the Revision No. </label>
                                        <input type="number" id="RevisionNo" disabled value="@Model.FormB9.RevisionNo" class="form-control">
                                    </div>
                                    <div class="form-group col-3">
                                        <label>Date </label>
                                        @Html.EditorFor(m => m.FormB9.RevisionDate, new { type = "date", htmlAttributes = new { @readonly = true, @class = "form-control" } })
                                    </div>
                                    <div class="form-group col-3">
                                        <label>User Name </label>
                                        <input id="UserName" disabled value="@Model.FormB9.UserName" class="form-control">
                                    </div>
                                </div>
                                <div class="row">

                                    <div class="col-12 bg-white px-0">
                                        <!--form g1-->
                                        <div id="content">
                                            <div class="w-100 position-relative in-tbl-btns custom-tbl">


                                                <div id="FormB9HistoryGrid" class="dataTables_wrapper dt-bootstrap4 no-footer">

                                                    <div class="dataTables_scroll">

                                                        <div class="dataTables_scrollBody" style="position: relative; overflow: auto; width: 100%; max-height: 100%; height: 100%;">
                                                            <table id="tblB9History" class="table w-100 nowrap dataTable no-footer">
                                                                <thead style="background-color: #c8e1ff">
                                                                    <tr>
                                                                        <th colspan="1">
                                                                            Features
                                                                        </th>

                                                                        <th colspan="1">
                                                                            Activity Code
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Activity Name
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Service Level  Cond.1
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Service Level  Cond.2
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Service Level  Cond.3
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Unit of Service Level
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Unit Description
                                                                        </th>
                                                                        <th colspan="1">
                                                                            Remarks
                                                                        </th>
                                                                    </tr>

                                                                </thead>
                                                                <tbody>
                                                                    @{
                                                                        for (int i = 0; i < Model.FormB9.FormB9History.Count; i++)
                                                                        {
                                                                            <tr>
                                                                                <td>
                                                                                    @Model.FormB9.FormB9History[i].Feature
                                                                                </td>
                                                                                <td>
                                                                                    @Model.FormB9.FormB9History[i].Code
                                                                                </td>
                                                                                <td>
                                                                                    @Model.FormB9.FormB9History[i].Name
                                                                                </td>
                                                                                <td class="typein" datatype="int">
                                                                                    @Model.FormB9.FormB9History[i].Cond1
                                                                                </td>
                                                                                <td class="typein" datatype="int">
                                                                                    @Model.FormB9.FormB9History[i].Cond2
                                                                                </td>
                                                                                <td class="typein" datatype="int">
                                                                                    @Model.FormB9.FormB9History[i].Cond3
                                                                                </td>
                                                                                <td class="dropdown" preval="@Model.FormB9.FormB9History[i].UnitOfServiceId">
                                                                                    @Model.FormB9.FormB9History[i].UnitOfService
                                                                                </td>
                                                                                <td class="typein">
                                                                                    @Model.FormB9.FormB9History[i].UnitDescription
                                                                                </td>
                                                                                <td class="typein">
                                                                                    @Model.FormB9.FormB9History[i].Remarks
                                                                                </td>
                                                                            </tr>
                                                                        }
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--form g1 -->
                                    </div>


                                </div>
                            </div>


                        </div>
                    </div>
                </div>

            </div>
        </div>


    </div>
</div>

<div class="col-md-12 mb-2 float-right text-right custom-footer">
    <button type="button" class="btn btn-sm btn-outline-theme" onclick="GoBack();">Close</button>
    @if (security.IsHeadMaintenance || security.IsRegionManager)
    {
        <button type="button" class="btn btn-sm btn-themebtn" id="btnSave" onclick="Save()">Save</button>
    }
</div>
<style>
    .custom-tbl div.dataTables_scrollHead table thead tr th:nth-child(4), .custom-tbl div.dataTables_scrollBody table tbody tr td:nth-child(4) {
        width: auto !important;
        min-width: auto !important;
    }

    .custom-tbl div.dataTables_scrollHead table thead tr th:nth-child(2), .custom-tbl div.dataTables_scrollBody table tbody tr td:nth-child(2), .custom-tbl div.dataTables_scrollHead table thead tr th:nth-child(3), .custom-tbl div.dataTables_scrollBody table tbody tr td:nth-child(3), .custom-tbl div.dataTables_scrollHead table thead tr th:nth-child(4), .custom-tbl div.dataTables_scrollBody table tbody tr td:nth-child(4), .custom-tbl div.dataTables_scrollHead table thead tr th:nth-child(5), .custom-tbl div.dataTables_scrollBody table tbody tr td:nth-child(5) {
        width: auto !important;
        min-width: auto !important;
    }
</style>

@Html.HiddenFor(m => m.FormB9.PkRefNo);
<input type="hidden" id="UserId" value="@security.UserID" />
<input type="hidden" id="hdnview" value="@Model.view" />
<input type="hidden" id="hdnRevisionDate" />


<script>
    var UnitServiceLevelObj = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(UnitServiceLevel));

    $("#UserName").val("@security.UserName");

    if ($("#hdnview").val() == 1) {
        $("#btnSave").hide();
    }
    else {
        getRevisionNo("@Model.FormB9.RevisionYear")

        var d = new Date();
        var month = d.getMonth() + 1;
        var day = d.getDate();
        var output = d.getFullYear() + '-' + (('' + month).length < 2 ? '0' : '') + month + '-' + (('' + day).length < 2 ? '0' : '') + day;
        $("#FormB9_RevisionDate").val(output);
    }



</script>